---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { Image } from "astro:assets";
import { getItemsWithThumbnails } from "../utils/contentUtils";
import TopPageBackground from "../components/TopPageBackground.astro";
import TopPageInteractions from "../components/TopPageInteractions.astro";

const projects = await getItemsWithThumbnails("projects");

const projectsByCategory = projects.reduce((acc, project) => {
	const category = project.data.category || "Uncategorized";
	if (!acc[category]) {
		acc[category] = [];
	}
	acc[category].push(project);
	return acc;
}, {});

for (const category of Object.keys(projectsByCategory)) {
	projectsByCategory[category].sort(
		(a, b) =>
			new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
	);
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Cumuloworks</title>
	</head>
	<body class="flex flex-col h-svh">
		<!-- <Header /> -->
		<main class="flex-grow">
			<section class="w-full h-svh bg-black relative">
				<TopPageBackground />
				<TopPageInteractions />
			</section>
			<section>
				<h2 class="text-2xl font-semibold mb-6">Projects</h2>
				{
					Object.entries(projectsByCategory).map(
						([category, categoryProjects]) => (
							<div class="mb-8">
								<h3 class="text-xl font-semibold mb-4">
									{category}
								</h3>
								<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
									{categoryProjects
										.slice(0, 3)
										.map((project) => (
											<div class="border rounded-lg overflow-hidden shadow-md">
												{project.thumbnail && (
													<Image
														src={project.thumbnail}
														alt={`Thumbnail for ${project.data.title}`}
														width={400}
														height={300}
														class="w-full h-48 object-cover"
													/>
												)}
												<div class="p-4">
													<h4 class="text-lg font-semibold mb-2">
														{project.data.title}
													</h4>
													<p class="text-sm text-gray-600 mb-2">
														{new Date(
															project.data.date,
														).toLocaleDateString()}
													</p>
													<p class="text-sm mb-4">
														{
															project.data
																.description
														}
													</p>
													<a
														href={`/projects/${project.slug}`}
														class="text-blue-600 hover:underline"
													>
														Read more
													</a>
												</div>
											</div>
										))}
								</div>
								{categoryProjects.length > 3 && (
									<p class="mt-4">
										<a
											href="/projects"
											class="text-blue-600 hover:underline"
										>
											View more {category} projects...
										</a>
									</p>
								)}
							</div>
						),
					)
				}
			</section>
		</main>
		<Footer />
	</body>
</html>
