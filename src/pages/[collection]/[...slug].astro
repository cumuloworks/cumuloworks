---
import type { ContentEntryMap } from "astro:content";
import { getCollection, getEntry } from "astro:content";
import Gallery from "@/components/Gallery.astro";
import Layout from "@/layouts/Layout.astro";

export async function getStaticPaths() {
	const collections = ["projects", "blogs", "downloads"];
	const allPaths = await Promise.all(
		collections.map(async (collection) => {
			const items = await getCollection(
				collection as keyof ContentEntryMap,
			);
			return items.map((entry) => ({
				params: { collection, slug: entry.slug },
				props: { collection, slug: entry.slug },
			}));
		}),
	);
	return allPaths.flat();
}

const { collection, slug } = Astro.props;
const currentItem = await getEntry(collection as keyof ContentEntryMap, slug);
const { Content } = await currentItem.render();

const galleryFolderPath = `/src/content/${collection}/${slug}/`;

const { ...frontmatter } = currentItem.data;
---

<Layout frontmatter={frontmatter}>
	<Content />
	{collection === "projects" && <Gallery folderPath={galleryFolderPath} />}
</Layout>
