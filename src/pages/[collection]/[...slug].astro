---
import type { ContentEntryMap } from "astro:content";
import { getCollection } from "astro:content";
import Gallery from "@/components/content/Gallery.astro";
import Hero from "@/components/content/Hero.astro";
import Layout from "@/layouts/Layout.astro";
import {
	getItemsWithThumbnails,
	getItemWithThumbnail,
} from "@/utils/contentUtils";

export async function getStaticPaths() {
	const collections = ["projects", "blogs", "downloads"];
	const allPaths = await Promise.all(
		collections.map(async (collection) => {
			const items = await getCollection(
				collection as keyof ContentEntryMap,
			);
			return items.map((entry) => ({
				params: { collection, slug: entry.slug },
				props: { collection, slug: entry.slug },
			}));
		}),
	);
	return allPaths.flat();
}

const { collection, slug } = Astro.props;
const currentItem = await getItemWithThumbnail(collection, slug);
const { Content } = await currentItem.render();

const items = await getItemsWithThumbnails(collection);
const currentIndex = items.findIndex((item) => item.slug === slug);
const prevItem = items[currentIndex + 1] || null;
const nextItem = items[currentIndex - 1] || null;

const galleryFolderPath = `/src/content/${collection}/${slug}/`;

const { ...frontmatter } = currentItem.data;
---

<Layout frontmatter={frontmatter}>
	<Content />
	{collection === "projects" && <Gallery folderPath={galleryFolderPath} />}
</Layout>
